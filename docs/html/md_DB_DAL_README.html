<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Battleships: API PHP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Battleships
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">API PHP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md4"></a>
Description</h1>
<p>Cette API a été écrite dans le cadre du module PHP lors de ma deuxième année de Bachelor à Ynov Aix-en-Provence. L'API vient interfacer le DAL (Data Access Layer) d'une base de donnée MySQL</p>
<p>Cette API a été codé avec du <b>PHP 5.6</b></p>
<h1><a class="anchor" id="autotoc_md5"></a>
Sommaire</h1>
<ol type="1">
<li><a href="#Description">Description</a></li>
</ol>
<ol type="1">
<li><a href="#Commencer">Commencer</a><ol type="a">
<li><a href="#Installation">Installation</a></li>
</ol>
<ol type="a">
<li><a href="#Utilisation">Utilisation</a></li>
</ol>
<ol type="a">
<li><a href="#Endpoint">Endpoint</a></li>
</ol>
<ol type="a">
<li>[Gestion d'erreur](#Gestion%20d'erreur)</li>
</ol>
<ol type="a">
<li><a href="#Authentification">Authentification</a></li>
</ol>
<ol type="a">
<li><a href="#Limite%20de%20requ%C3%AAtes">Limite de requêtes</a></li>
</ol>
<ol type="a">
<li>[Pistes d'amélioration futur](#Pistes%20d'amC3A9lioration%20futur)</li>
</ol>
<ol type="a">
<li><a href="#Auteur">Auteur</a></li>
</ol>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md6"></a>
Commencer</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Installation</h2>
<p>Extraire le dossier <code>.zip</code> dans le dossier <code>www</code> de votre server Apache. L'arborescence devrait ressembler à ça: </p><div class="fragment"><div class="line">root</div>
<div class="line">|</div>
<div class="line">└──credentials</div>
<div class="line">|   └── db.json</div>
<div class="line">└── www</div>
<div class="line">    │</div>
<div class="line">    └── API</div>
<div class="line">        ├── dossier1</div>
<div class="line">        ├── fichier1</div>
<div class="line">        └── ...</div>
</div><!-- fragment --><p>Pour le bon fonctionnement du DAL il faut aussi un dossier <code>credentials</code> au même niveau que le dossier <code>www</code>. Dans ce dossier <code>credentials</code> il faudra y mettre un fichier JSON avec les identifiants à la base de données. Voici le format: </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;dbName&quot;: &quot;your_db_name&quot;,</div>
<div class="line">    &quot;login&quot;: &quot;your_db_user&quot;,</div>
<div class="line">    &quot;password&quot;: &quot;y0ur_us€r_Pa$$w0rd&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Le DAL lit par défaut le fichier <code>db.json</code> mais il est possible de lire un autre fichier. Il faudra simplement préciser le nom du fichier dans le constructeur de la classe <code>Database</code> en donnant un paramètre à la méthode <code>Connect</code>. À cette ligne: </p><div class="fragment"><div class="line">$this-&gt;dbh = Connection::Connect(&quot;your_db_file&quot;);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Utilisation</h2>
<p>Les requêtes à l'API se font toutes avec la méthode HTTP POST. Il faudra donc un logiciel (comme Postman) ou du code pour faire les requêtes et passer les arguments dans le body de la requête. La syntax pour les requêtes sera: </p><div class="fragment"><div class="line">{serverIP}/API/{endpoint}/</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Endpoint</h2>
<p>L'API a 5 endpoints, <b>Create</b>, <b>Read</b>, <b>Update</b>, <b>Delete</b> et <b>TestDB</b>. Ces endpoints permettent d'interagir avec la base de données. L'endpoint TestDB est un endpoint de test qui pour l'instant ne sert qu'à tester la méthode <code>read</code>.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Paramètres</h3>
<p>Chaque endpoint a ses paramètres à prendre en compte, certains ont les mêmes paramètres mais d'autre non, voici un tableau avec les paramètres pour chaque endpoint:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CRUD/Args   </th><th class="markdownTableHeadNone">table   </th><th class="markdownTableHeadNone">params   </th><th class="markdownTableHeadNone">columns   </th><th class="markdownTableHeadNone">filter    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Create   </td><td class="markdownTableBodyNone">OBLIGATOIRE   </td><td class="markdownTableBodyNone">OBLIGATOIRE   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">X    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Read   </td><td class="markdownTableBodyNone">OBLIGATOIRE   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">OBLIGATOIRE   </td><td class="markdownTableBodyNone">OPTIONEL    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Update   </td><td class="markdownTableBodyNone">OBLIGATOIRE   </td><td class="markdownTableBodyNone">OBLIGATOIRE   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">OBLIGATOIRE    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Delete   </td><td class="markdownTableBodyNone">OBLIGATOIRE   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">OBLIGATOIRE   </td></tr>
</table>
<ul>
<li><b>table</b>: Le nom de la table</li>
<li><b>params</b>: Ensemble clé-valeur avec les colonnes de la table en clé</li>
<li><b>columns</b>: Tableau de colonnes de la table (peut aussi valoir <code>"*"</code>)</li>
<li><b>filter</b>: Ensemble d'object JSON, dont la clé est le nom de la colonne et la valeur est un autre ensemble clé-valeur, avec pour clé <code>"operateur"</code> et <code>"value"</code> (voir exemple <a href="#Update">ci-dessous</a>)</li>
</ul>
<h3><a class="anchor" id="autotoc_md11"></a>
Create</h3>
<p>Ce endpoint permet d'écrire des entrées dans une table de la base de données. Ici <code>params</code> sont les valeurs à attribuer.</p>
<p>Voici un exemple de requête et d'arguments à passer:</p>
<p><b>En bash:</b> </p><div class="fragment"><div class="line">curl -X POST \</div>
<div class="line">  -H &#39;Content-Type: application/json&#39; \</div>
<div class="line">  -d &#39;{</div>
<div class="line">    &quot;table&quot;: &quot;your_table&quot;,</div>
<div class="line">    &quot;params&quot;: {</div>
<div class="line">      &quot;col1&quot;: &quot;value1&quot;,</div>
<div class="line">      &quot;col2&quot;: &quot;value2&quot;</div>
<div class="line">    }</div>
<div class="line">  }&#39; \</div>
<div class="line">  http://localhost/CreateDB/</div>
</div><!-- fragment --><p><b>En python:</b> </p><div class="fragment"><div class="line">import requests</div>
<div class="line"> </div>
<div class="line">url = &quot;http://localhost/CreateDB/&quot;</div>
<div class="line">data = {</div>
<div class="line">    &quot;table&quot;: &quot;your_table&quot;,</div>
<div class="line">    &quot;params&quot;: {</div>
<div class="line">        &quot;col1&quot;: &quot;value1&quot;,</div>
<div class="line">        &quot;col2&quot;: &quot;value2&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">response = requests.post(url, json=data)</div>
<div class="line"> </div>
<div class="line">print(response.json())  # If the response contains JSON data</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md12"></a>
Read</h3>
<p>Ce endpoint permet de lire des entrées dans une table de la base de données. Ici <code>columns</code> sont les colonnes à lire dans la table. Il est aussi possible de lire toutes les colonnes d'une table en écrivant <code>"columns": "*"</code></p>
<p>Possibilité de rajouter <code>filter</code> à la requête (voir exemple <a href="#Update">ci-dessous</a>)</p>
<p>Voici un exemple de requête et d'arguments à passer:</p>
<p><b>En bash:</b> </p><div class="fragment"><div class="line">curl -X POST \</div>
<div class="line">  -H &#39;Content-Type: application/json&#39; \</div>
<div class="line">  -d &#39;{</div>
<div class="line">    &quot;table&quot;: &quot;your_table&quot;,</div>
<div class="line">    &quot;columns&quot;: [</div>
<div class="line">      &quot;col1&quot;,</div>
<div class="line">      &quot;col2&quot;</div>
<div class="line">    ]</div>
<div class="line">  }&#39; \</div>
<div class="line">  http://localhost/ReadDB/</div>
</div><!-- fragment --><p><b>En python:</b> </p><div class="fragment"><div class="line">import requests</div>
<div class="line"> </div>
<div class="line">url = &quot;http://localhost/ReadDB/&quot;</div>
<div class="line">data = {</div>
<div class="line">    &quot;table&quot;: &quot;your_table&quot;,</div>
<div class="line">    &quot;columns&quot;: [</div>
<div class="line">        &quot;col1&quot;,</div>
<div class="line">        &quot;col2&quot;</div>
<div class="line">    ]</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">response = requests.post(url, json=data)</div>
<div class="line"> </div>
<div class="line">print(response.json())  # If the response contains JSON data</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md13"></a>
Update</h3>
<p>Ce endpoint permet de modifier des entrées dans une table de la base de données. Ici <code>params</code> sont les nouvelles valeurs et les object JSON dans <code>filter</code> permettent de créer la clause <code>WHERE</code> de la requête SQL.</p>
<p>Voici un exemple de requête et d'arguments à passer:</p>
<p><b>En bash:</b> </p><div class="fragment"><div class="line">curl -X POST \</div>
<div class="line">  -H &#39;Content-Type: application/json&#39; \</div>
<div class="line">  -d &#39;{</div>
<div class="line">    &quot;table&quot;: &quot;your_table&quot;,</div>
<div class="line">    &quot;params&quot;: {</div>
<div class="line">        &quot;prenom&quot;: &quot;Paul&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;filter&quot;: {</div>
<div class="line">        &quot;age&quot;: {</div>
<div class="line">            &quot;operator&quot;: &quot;&gt;&quot;,</div>
<div class="line">            &quot;value&quot;: &quot;23&quot;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  }&#39; \</div>
<div class="line">  http://localhost/UpdateDB/</div>
</div><!-- fragment --><p><b>En python:</b> </p><div class="fragment"><div class="line">import requests</div>
<div class="line"> </div>
<div class="line">url = &quot;http://localhost/UpdateDB/&quot;</div>
<div class="line">data = {</div>
<div class="line">    &quot;table&quot;: &quot;your_table&quot;,</div>
<div class="line">    &quot;params&quot;: {</div>
<div class="line">        &quot;prenom&quot;: &quot;Paul&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;filter&quot;: {</div>
<div class="line">        &quot;prenom&quot;: {</div>
<div class="line">            &quot;operator&quot;: &quot;=&quot;,</div>
<div class="line">            &quot;value&quot;: &quot;Pierre&quot;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">response = requests.post(url, json=data)</div>
<div class="line"> </div>
<div class="line">print(response.json())  # If the response contains JSON data</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md14"></a>
Delete</h3>
<p>Ce endpoint permet de supprimer des entrées dans une table de la base de données. Ici <code>filter</code> permet de sélectionner les bonnes valeurs à supprimer</p>
<p>Voici un exemple de requête et d'arguments à passer:</p>
<p><b>En bash:</b> </p><div class="fragment"><div class="line">curl -X POST \</div>
<div class="line">  -H &#39;Content-Type: application/json&#39; \</div>
<div class="line">  -d &#39;{</div>
<div class="line">    &quot;table&quot;: &quot;your_table&quot;,</div>
<div class="line">    &quot;filter&quot;: {</div>
<div class="line">      &quot;age&quot;: {</div>
<div class="line">        &quot;operator&quot;: &quot;&gt;&quot;,</div>
<div class="line">        &quot;value&quot;: &quot;23&quot;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }&#39; \</div>
<div class="line">  http://localhost/DeleteDB/</div>
</div><!-- fragment --><p><b>En python:</b> </p><div class="fragment"><div class="line">import requests</div>
<div class="line"> </div>
<div class="line">url = &quot;http://localhost/DeleteDB/&quot;</div>
<div class="line">data = {</div>
<div class="line">    &quot;table&quot;: &quot;your_table&quot;,</div>
<div class="line">    &quot;filter&quot;: {</div>
<div class="line">        &quot;prenom&quot;: {</div>
<div class="line">            &quot;operator&quot;: &quot;=&quot;,</div>
<div class="line">            &quot;value&quot;: &quot;Pierre&quot;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">response = requests.post(url, json=data)</div>
<div class="line"> </div>
<div class="line">print(response.json())  # If the response contains JSON data</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
Gestion d'erreur</h2>
<p>En cas d'erreur l'API renverra du JSON avec le format: </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;Error&quot;: &quot;Error message&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Authentification</h2>
<p>L'API ne possède pas de système d'authentification.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Limite de requêtes</h2>
<p>L'API ne possède pas de limite de requêtes.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Pistes d'améliorations futurs</h2>
<ul>
<li>Il faudrait que les valeurs de <code>ALLOWED_ARGS</code> et <code>NEEDED_ARGS</code> ne soient pas en brut dans le code, peut-être en les ayant dans un autre fichier que le DAL viendrait juste lire</li>
<li>Avoir une classe Credentials</li>
<li>Pouvoir Insert plusieurs lignes à la fois</li>
<li>Avoir un autoloader</li>
</ul>
<h2><a class="anchor" id="autotoc_md19"></a>
Auteur</h2>
<ul>
<li>Théo COLLIOT-MARTINEZ </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
